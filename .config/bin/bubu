#!/usr/bin/env bash

# TODO: show releases URLS for each apps

gum style \
	--foreground 12 --border-foreground 12 --border double \
	--align center --width 50 --margin "1 1" --padding "1 2" \
	'██████╗ ██████╗ ███████╗██╗    ██╗
██╔══██╗██╔══██╗██╔════╝██║    ██║
██████╔╝██████╔╝█████╗  ██║ █╗ ██║
██╔══██╗██╔══██╗██╔══╝  ██║███╗██║
██████╔╝██║  ██║███████╗╚███╔███╔╝
╚═════╝ ╚═╝  ╚═╝╚══════╝ ╚══╝╚══╝'

gum spin --show-output --spinner minidot --title "Updating brew..." -- brew update
printf "\n"

OUTDATED=$(gum spin --show-output --spinner minidot --title "Checking for outdated brew packages" -- brew outdated)

if [[ -n "$OUTDATED" ]]; then
	echo "$OUTDATED"
	CONFIRM=$(gum confirm "Upgrade the outdated formulae above? (y/N)")

	if [[ $CONFIRM -eq 0 ]]; then
		printf "\n"
		gum spin --show-output --spinner minidot --title "Upgrading brew packages..." -- brew upgrade
		printf "\n"

		gum spin --show-output --spinner minidot --title "Cleaning up brew..." -- brew cleanup --prune=all
		printf "\n"
	else
		echo "Upgrading brew packages cancelled."
	fi
else
	echo "No brew packages need upgraded at this time."
fi

printf "\n"
gum spin --show-output --spinner minidot --title "Checking for brew issues..." -- brew doctor

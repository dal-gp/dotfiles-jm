#!/usr/bin/env bash
# cSpell:words worktree
cd ~/c/nu || return
BRANCH=$(gum input --placeholder "New branch name")
BRANCH=${BRANCH#jam/}
echo "üå≥ Using branch 'jam/$BRANCH'"
REMOTE_BRANCH=$(git ls-remote --heads origin "$BRANCH" | wc -l)
if [ "$REMOTE_BRANCH" -eq 0 ]; then
  echo "‚òÅÔ∏è Branch 'jam/$BRANCH' does not exist on remote, creating it"
  git worktree add "$BRANCH" -b "jam/$BRANCH" origin/main
  git push --set-upstream origin "jam/$BRANCH"
else
  echo "‚òÅÔ∏è Branch 'jam/$BRANCH' exists on remote, using it"
  git worktree add "$BRANCH" -b "jam/$BRANCH" origin/jam/"$BRANCH"
fi
cd "$BRANCH" || return
sesh connect . --command "nu_setup"
